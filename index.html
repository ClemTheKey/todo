
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>ToDo Gamifi√© - Fusion Fiable</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f5f5f5;
      margin: 0;
      padding: 1rem;
    }
    header {
      background: #4CAF50;
      color: white;
      text-align: center;
      padding: 1rem;
    }
    .container {
      max-width: 800px;
      margin: auto;
      background: white;
      padding: 1rem;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    .form-group {
      margin-bottom: 1rem;
    }
    .profile {
      background: #ffffff;
      border-radius: 8px;
      padding: 1rem;
      margin-top: 2rem;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
    }
    .progress-bar {
      width: 100%;
      height: 20px;
      background: #ddd;
      border-radius: 10px;
      overflow: hidden;
    }
    .progress-fill {
      height: 100%;
      width: 0;
      background: #4CAF50;
      transition: width 0.3s ease;
    }
    ul {
      list-style: none;
      padding-left: 0;
    }
    li {
      padding: 0.5rem;
      border-bottom: 1px solid #ddd;
      cursor: pointer;
    }
    h3 {
      margin-bottom: 0.3rem;
      color: #555;
    }
  </style>
</head>
<body>
  <header>ToDo Gamifi√© - Regroupement & XP</header>
  <nav style="text-align:center; margin-top: 0.5rem;">
    <a href="settings.html" style="margin:0 1rem;">‚öôÔ∏è R√©glages</a>
    <a href="history.html" style="margin:0 1rem;">üìú Historique</a>
    <a href="badges.html" style="margin:0 1rem;">üèÖ Badges</a>
  </nav>

  <div class="container">
    <h2>T√¢ches</h2>
    <div class="form-group" id="groupControls">
      <label for="groupBy">Regrouper par :</label>
      <select id="groupBy" onchange="render()">
        <option value="category">Cat√©gorie</option>
        <option value="type">P√©riodicit√©</option>
      </select>
    </div>
    <div class="profile">
      <h2>Profil</h2>
      <p><strong>XP Totale:</strong> <span id="xpTotal">0</span></p>
      <p><strong>Niveau:</strong> <span id="level">1</span></p>
      <p><strong>XP avant prochain niveau:</strong> <span id="xpToNext">100</span></p>
      <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
      </div>
    </div>
    <ul id="taskList"></ul>
  </div>
  <script>
    const tasks = [
      { name: "Courir", category: "Sport", type: "quotidien", points: 10 },
      { name: "Salade", category: "Alimentation", type: "ponctuel", points: 5 },
      { name: "M√©ditation", category: "Healthy Life", type: "quotidien", points: 8 },
      { name: "Ecrire", category: "Good Habit", type: "hebdomadaire", points: 12 },
      { name: "Projet X", category: "Succ√®s", type: "ponctuel", points: 15 }
    ];

    const levelThresholds = [
      100, 125, 144, 158, 170, 181, 191, 200, 208, 215, 222, 228, 235, 241, 246, 251, 257, 262, 266, 271,
      275, 280, 284, 288, 292, 296, 300, 303, 307, 310, 314, 317, 320, 323, 327, 330, 333, 336, 339, 341,
      344, 347, 350, 353, 355, 358, 360, 363, 365, 368, 370, 373, 375, 377, 380, 382, 384, 387, 389, 391,
      393, 395, 397, 400, 402, 404, 406, 408, 410, 412, 414, 416, 417, 419, 421, 423, 425, 427, 429, 430,
      432, 434, 436, 437, 439, 441, 443, 444, 446, 448, 449, 451, 453, 454, 456, 457, 459, 461, 462, 463
    ];
    let xp = 0;

    function getLevelFromXP(xp) {
      let total = 0;
      for (let i = 0; i < levelThresholds.length; i++) {
        total += levelThresholds[i];
        if (xp < total) return i;
      }
      return levelThresholds.length;
    }

    function updateProfile() {
      const level = getLevelFromXP(xp);
      document.getElementById("xpTotal").textContent = xp;
      document.getElementById("level").textContent = level;
      let previous = levelThresholds.slice(0, level).reduce((a,b) => a + b, 0);
      let next = levelThresholds[level] || 1;
      let current = xp - previous;
      document.getElementById("xpToNext").textContent = next - current;
      document.getElementById("progressFill").style.width = Math.min(100, (current / next) * 100) + "%";
    }

    function render() {
      const taskList = document.getElementById("taskList");
      taskList.innerHTML = '';
      const groupBy = document.getElementById("groupBy")?.value || "category";

      const grouped = {};
      tasks.forEach(task => {
        const key = task[groupBy] || 'Autre';
        if (!grouped[key]) grouped[key] = [];
        grouped[key].push(task);
      });

      Object.entries(grouped).forEach(([group, items]) => {
        const header = document.createElement("h3");
        header.textContent = group;
        taskList.appendChild(header);

        items.forEach(task => {
          const li = document.createElement("li");
          li.textContent = `${task.name} (${task.points} XP)`;
          li.onclick = () => {

            xp += task.points;
            updateProfile();
            li.style.textDecoration = "line-through";
            li.style.opacity = 0.6;
            li.onclick = null;
          
            addToHistory(task);
        };
          taskList.appendChild(li);
        });
      });
    }

    
function addToHistory(task) {
  const history = JSON.parse(localStorage.getItem("history") || "[]");
  const date = new Date().toLocaleDateString("fr-FR");
  history.unshift({
    name: task.name,
    category: task.category,
    type: task.type,
    date: date
  });
  localStorage.setItem("history", JSON.stringify(history));
}


document.addEventListener("DOMContentLoaded", () => {
      render();
      updateProfile();
    });
  </script>
</body>
</html>
